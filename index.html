<script type="module">
    import { auth, onAuthStateChanged } from './firebase-config.js';
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

    const db = getFirestore();

    onAuthStateChanged(auth, async (user) => {
        if (user) {
            const userRole = await getUserRole(user.uid);

            if (userRole) {
                if (userRole === 'Admin') {
                    document.getElementById('add-project-btn').style.display = 'block';
                    document.getElementById('planning-btn').style.display = 'block';
                    document.getElementById('view-schedule-btn').style.display = 'block';
                    document.getElementById('status-btn').style.display = 'block';
                    document.getElementById('planning-total-btn').style.display = 'block';
                    document.getElementById('time-reporting-btn').style.display = 'block';
                    document.getElementById('export-time-report-btn').style.display = 'block';
                    
                    // Skapa och lägg till admin-länken
                    const adminLink = document.createElement('a');
                    adminLink.href = 'admin.html';
                    adminLink.textContent = 'Admin Dashboard';
                    adminLink.className = 'btn btn-admin'; // CSS-klass för styling
                    document.body.appendChild(adminLink);
                    
                } else if (userRole === 'Montör') {
                    document.getElementById('view-schedule-btn').style.display = 'block';
                    document.getElementById('time-reporting-btn').style.display = 'block';
                } else if (userRole === 'Säljare') {
                    document.getElementById('planning-total-btn').style.display = 'block';
                    document.getElementById('time-reporting-btn').style.display = 'block';
                } else if (userRole === 'Service') {
                    document.getElementById('planning-total-btn').style.display = 'block';
                    document.getElementById('time-reporting-btn').style.display = 'block';
                    document.getElementById('status-btn').style.display = 'block';
                } else {
                    alert('Du har inte behörighet att se denna sida.');
                    window.location.href = 'login.html';
                }
            } else {
                console.error('Ingen roll hittades för användaren.');
                window.location.href = 'login.html';
            }
        }
    });

    async function getUserRole(uid) {
        try {
            const userRef = doc(db, 'users', uid);
            const userDoc = await getDoc(userRef);
            if (userDoc.exists()) {
                return userDoc.data().role;
            } else {
                console.error("Inget dokument hittades för användaren!");
                return null;
            }
        } catch (error) {
            console.error("Fel vid hämtning av användarens roll:", error);
            return null;
        }
    }
</script>
