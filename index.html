<script type="module">
    import { auth, onAuthStateChanged } from './firebase-config.js';
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

    const db = getFirestore();

    onAuthStateChanged(auth, async (user) => {
        if (user) {
            const userRole = await getUserRole(user.uid);

            if (userRole) {
                if (userRole === 'Admin') {
                    showElement('add-project-btn');
                    showElement('planning-btn');
                    showElement('view-schedule-btn');
                    showElement('status-btn');
                    showElement('planning-total-btn');
                    showElement('time-reporting-btn');
                    showElement('export-time-report-btn');
                    
                    // Skapa och lägg till admin-länken om den inte redan finns
                    if (!document.querySelector('.btn-admin')) {
                        const adminLink = document.createElement('a');
                        adminLink.href = 'admin.html';
                        adminLink.textContent = 'Admin Dashboard';
                        adminLink.className = 'btn btn-admin'; // CSS-klass för styling
                        document.body.appendChild(adminLink);
                    }
                    
                } else if (userRole === 'Montör') {
                    showElement('view-schedule-btn');
                    showElement('time-reporting-btn');
                } else if (userRole === 'Säljare') {
                    showElement('planning-total-btn');
                    showElement('time-reporting-btn');
                } else if (userRole === 'Service') {
                    showElement('planning-total-btn');
                    showElement('time-reporting-btn');
                    showElement('status-btn');
                } else {
                    alert('Du har inte behörighet att se denna sida.');
                    window.location.href = 'login.html';
                }
            } else {
                console.error('Ingen roll hittades för användaren.');
                window.location.href = 'login.html';
            }
        } else {
            window.location.href = 'login.html';
        }
    });

    async function getUserRole(uid) {
        try {
            const userRef = doc(db, 'users', uid);
            const userDoc = await getDoc(userRef);
            if (userDoc.exists()) {
                return userDoc.data().role;
            } else {
                console.error("Inget dokument hittades för användaren!");
                return null;
            }
        } catch (error) {
            console.error("Fel vid hämtning av användarens roll:", error);
            return null;
        }
    }

    function showElement(id) {
        const element = document.getElementById(id);
        if (element) {
            element.style.display = 'block';
        }
    }
</script>
